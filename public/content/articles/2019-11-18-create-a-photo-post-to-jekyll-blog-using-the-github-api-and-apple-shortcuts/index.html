<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a photo post to Jekyll blog using the GitHub API and Apple Shortcuts</title>
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
    <h1>Create a photo post to Jekyll blog using the GitHub API and Apple Shortcuts</h1>

    <p>I've recently added a photos section to my site, and in keeping with the indie web movement I wanted to post photos to my site first and look to POSSE later.</p>
<p>I've been keen to try out the Shortcuts app on my phone and seemed an ideal way to give it a go. I've seem a few similar approaches on uploading content to GitHub, and they all relied on the <a href="https://workingcopyapp.com/">Working Copy</a> app to do so.</p>
<p>This shortcut submits the content directly to GitHub using the <a href="https://developer.github.com/v3/repos/contents/#create-or-update-a-file">GitHub API</a>.</p>
<p>Once committed, <a href="https://www.netlify.com/">Netlify</a> sees the changes in my repository, then builds and deploys my site.</p>
<p>You can download a copy of the shared version of the <a href="https://www.icloud.com/shortcuts/419cf74b2dfe4dad8f31fb38f64f6b50">shortcut</a>. When installing it will prompt you to provide the following prerequisites.</p>
<h2>Prerequisites</h2>
<ul>
<li><strong>GitHub username</strong> – used to authenticate to the GitHub API.</li>
<li><strong>GitHub repository name</strong> – the repository you are uploading to.</li>
<li><strong>GitHub personal access token</strong> – this must have read/write access to the appropriate repository. View the <a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">Github docs</a> to find out how to create a access token.</li>
<li><strong>GitHub committer</strong> <strong>name</strong> and <strong>email address</strong> – used when committing files to the repository.</li>
<li><strong>Image upload path</strong> – where the photos should be uploaded.</li>
<li><strong>Post upload path</strong> – where the markdown file should be created e.g. _photos .</li>
</ul>
<h2>What the shortcut does</h2>
<ol>
<li>You can pass a photo using a share sheet or choosing a photo directly when running the shortcut.</li>
<li>The photo is resized to a maximum of 1024px wide</li>
<li>Converts the image to a JPG from HEIC</li>
<li>Prompts you to Set a title</li>
<li>Prompts you to Provide Alt text</li>
<li>Prompts you to enter tags</li>
<li>Uses the Photo creation date and the provided title to generate a filename which is auto hyphenated and converted to lowercase.</li>
<li>BASE64 encodes the image to send via the GitHub API</li>
<li>Uploads the image to GitHub to path specified during shortcut setup, it automatically places the file in a /year/month/ structure.</li>
<li>Creates and uploads a markdown file containing the location, latitude, longitude, alt text, title, date, image and tags using YAML front matter.</li>
</ol>
<h2>YAML front matter structure</h2>
<table class="striped">
    <caption>A table explaining how the front matter is populated</caption>
    <tr>
        <th>Front matter field</th>
        <th>Data population</th>
    </tr>
    <tr>
        <td>title</td>
        <td>Uses the title provided by the user.</td>
    </tr>
    <tr>
        <td>date</td>
        <td>Uses the creation date of the photo.</td>
    </tr>
    <tr>
        <td>altText</td>
        <td>Uses the alt text provided at the prompt.</td>
    </tr>
    <tr>
        <td>location</td>
        <td>Gets the Town/City from the photo GPS coordinates when available.</td>
    </tr>
    <tr>
        <td>geolocation</td>
        <td>An array.</td>
    </tr>
    <tr>
        <td>latitude</td>
        <td>Get the latitude from the photo GPS coordinates.</td>
    </tr>
    <tr>
        <td>longitude</td>
        <td>Get the longitude from the photo GPS coordinates.</td>
    </tr>
    <tr>
        <td>image</td>
        <td>A file path created from upload path and year and months from the photo creation date e.g.
            /uploadpath/2019/11/filename.jpg</td>
    </tr>
    <tr>
        <td>tags</td>
        <td>An array of tags.</td>
    </tr>
</table>
<h2>Notes / quirks</h2>
<ul>
<li>There was a lot of messing about with trimming variable names which seem to get space added to the end of them. I had to use the replace text action with a regular expression to tidy them up.</li>
<li>I want to add setting location as an optional setting when running the shortcut.</li>
<li>Need to get this working with Git LFS properly</li>
<li>Large images seemed to get corrupted on upload so put the resize action in to improve the upload.</li>
</ul>

    
</body>
</html>